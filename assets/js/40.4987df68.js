(window.webpackJsonp=window.webpackJsonp||[]).push([[40],{402:function(e,t,r){"use strict";r.r(t);var _=r(21),o=Object(_.a)({},(function(){var e=this,t=e.$createElement,r=e._self._c||t;return r("ContentSlotsDistributor",{attrs:{"slot-key":e.$parent.slotKey}},[r("h1",{attrs:{id:"扫码登录的实现原理"}},[r("a",{staticClass:"header-anchor",attrs:{href:"#扫码登录的实现原理"}},[e._v("#")]),e._v(" 扫码登录的实现原理")]),e._v(" "),r("h2",{attrs:{id:"rfc6749"}},[r("a",{staticClass:"header-anchor",attrs:{href:"#rfc6749"}},[e._v("#")]),e._v(" RFC6749")]),e._v(" "),r("p",[e._v("OAuth 2.0 规定了四种获得令牌的流程:")]),e._v(" "),r("ul",[r("li",[e._v("授权码（authorization-code）")]),e._v(" "),r("li",[e._v("隐藏式（implicit）")]),e._v(" "),r("li",[e._v("密码式（password）：")]),e._v(" "),r("li",[e._v("客户端凭证（client credentials）\n而一般扫码登录的网站都是使用的"),r("code",[e._v("授权码")]),e._v("方式实现的;也就是:")])]),e._v(" "),r("blockquote",[r("p",[e._v("通过向三方登录系统获取授权码,在通过授权码+client_id信息向三方获取令牌,通过令牌就可以获取用户在三方的信息")])]),e._v(" "),r("h2",{attrs:{id:"微信登录流程"}},[r("a",{staticClass:"header-anchor",attrs:{href:"#微信登录流程"}},[e._v("#")]),e._v(" 微信登录流程")]),e._v(" "),r("blockquote",[r("p",[e._v("要想实现微信登录首先需要有一个已经审核通过的网站,并获得相应的"),r("code",[e._v("AppID")]),e._v("和"),r("code",[e._v("AppSecret")]),e._v(",并且申请通过了微信登录的权限")])]),e._v(" "),r("p",[r("img",{attrs:{src:"https://slbblog.oss-cn-beijing.aliyuncs.com/saves/wx-oauth.png",alt:"流程"}})]),e._v(" "),r("ul",[r("li",[e._v("用户通过点击网站微信授权登录按钮,进入微信授权登录页面,链接:"),r("code",[e._v("https://open.weixin.qq.com/connect/qrconnect?appid=${APPID}&redirect_uri=${REDIRECT_URI}&response_type=code&scope=snsapi_login&state=${STATE}#wechat_redirect")]),e._v(";\n"),r("ul",[r("li",[e._v("appid: 必填,在开发者平台申请的唯一id,是应用的唯一标识,同时微信官方也可以通过这个id知道请求方是谁")]),e._v(" "),r("li",[e._v("redirect_uri: 必填,当用户同意或拒绝后的跳转地址,同时会携带一个"),r("code",[e._v("code授权码")]),e._v(",例:https://slbyml.github.io//callback?code=AUTHORIZATION_CODE")]),e._v(" "),r("li",[e._v("response_type: 必填, 标识返回的授权码(code)(超时时间为10分钟)")]),e._v(" "),r("li",[e._v("scope: 必填,代表授权做用户,一般为"),r("code",[e._v("snsapi_login")])]),e._v(" "),r("li",[e._v("state 非必填,此为微信官方加的,用于保持请求和回调的状态，授权请求后原样带回给第三方。该参数可用于防止csrf攻击（跨站请求伪造攻击），建议第三方带上该参数，可设置为简单的随机数加session进行校验")])])]),e._v(" "),r("li",[e._v("微信官方对链接验证通过后会返回一个二维码,同时浏览器端通过长"),r("code",[e._v("轮询")]),e._v("("),r("a",{attrs:{href:"http://www.52im.net/thread-338-1-1.html#7",target:"_blank",rel:"noopener noreferrer"}},[e._v("long-polling"),r("OutboundLink")],1),e._v(")的方式请求微信服务器,并通过返回状态确定用户是否扫码和授权")]),e._v(" "),r("li",[e._v("当用户通过手机扫码并授权后,微信后端会调用回调地址"),r("code",[e._v("redirect_uri")]),e._v(",并将授权临时票据(code)返回")]),e._v(" "),r("li",[e._v("我们的后端拿到票据后,会继续请求微信服务器去获取授"),r("code",[e._v("权令牌")]),e._v("(access_token):地址:"),r("code",[e._v("https://api.weixin.qq.com/sns/oauth2/access_token?appid=${APPID}&secret=${SECRET}&code=${CODE}&grant_type=${authorization_code}")]),e._v(" "),r("ul",[r("li",[e._v("appid: 唯一标识")]),e._v(" "),r("li",[e._v("secret: 应用密钥,通过appid+secret可以确认网站的身份")]),e._v(" "),r("li",[e._v("code: 上一步拿到的授权码")]),e._v(" "),r("li",[e._v("grant_type: 填authorization_code,表示采用的授权方式是授权码")])])]),e._v(" "),r("li",[e._v("微信后端确认无误后会返回带有"),r("code",[e._v("access_token")]),e._v("的JSON数据")]),e._v(" "),r("li",[e._v("我们拿到"),r("code",[e._v("access_token")]),e._v("就可以通过令牌调用微信接口获取用户数据")])]),e._v(" "),r("h2",{attrs:{id:"参考"}},[r("a",{staticClass:"header-anchor",attrs:{href:"#参考"}},[e._v("#")]),e._v(" 参考")]),e._v(" "),r("ul",[r("li",[r("a",{attrs:{href:"http://www.ruanyifeng.com/blog/2019/04/oauth-grant-types.html",target:"_blank",rel:"noopener noreferrer"}},[e._v("OAuth 2.0 的四种方式"),r("OutboundLink")],1)]),e._v(" "),r("li",[r("a",{attrs:{href:"https://developers.weixin.qq.com/doc/oplatform/Website_App/WeChat_Login/Wechat_Login.html",target:"_blank",rel:"noopener noreferrer"}},[e._v("微信登录功能介绍"),r("OutboundLink")],1)]),e._v(" "),r("li",[r("a",{attrs:{href:"http://www.52im.net/thread-338-1-1.html",target:"_blank",rel:"noopener noreferrer"}},[e._v("传统Web的通信原理"),r("OutboundLink")],1)]),e._v(" "),r("li",[r("a",{attrs:{href:"https://juejin.cn/post/6924218259302694919?utm_source=gold_browser_extension",target:"_blank",rel:"noopener noreferrer"}},[e._v("微信扫码登录背后的实现原理"),r("OutboundLink")],1)]),e._v(" "),r("li",[r("a",{attrs:{href:"https://blog.csdn.net/windforce828/article/details/104607286",target:"_blank",rel:"noopener noreferrer"}},[e._v("微信扫码登录的几秒钟里，到底发生了什么"),r("OutboundLink")],1)]),e._v(" "),r("li",[r("a",{attrs:{href:"https://www.cnblogs.com/rsapaper/p/9218212.html",target:"_blank",rel:"noopener noreferrer"}},[e._v("The OAuth 2.0 Authorization Framework OAuth2.0的核心角色code 扫码登录"),r("OutboundLink")],1)])])])}),[],!1,null,null,null);t.default=o.exports}}]);